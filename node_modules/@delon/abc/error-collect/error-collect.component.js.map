{"version":3,"file":"error-collect.component.js","sourceRoot":"","sources":["../../../.ng_build/abc/error-collect/error-collect.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Directive, OnInit, Input, HostBinding, OnDestroy, ElementRef, Renderer2, HostListener, Inject, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\r\nimport { FormGroup } from '@angular/forms';\r\nimport { DOCUMENT } from '@angular/platform-browser';\r\nimport { coerceNumberProperty } from '@angular/cdk/coercion';\r\n\r\nconst ANTDERRORCLS = '.has-error';\r\nconst HEADERMINHEIGHT = 65 + 8 * 2;\r\n\r\n/**\r\n * 错误消息采集器\r\n * PS：虽然此法并不好看，但对响应式表单&模板表单有很好的效果。\r\n */\r\n@Component({\r\n    selector: 'error-collect, [error-collect]',\r\n    template: `<i class=\"anticon anticon-exclamation-circle\"></i> {{count}}`,\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ErrorCollectComponent implements OnInit, OnDestroy {\r\n\r\n    $time = null;\r\n    formEl: HTMLFormElement;\r\n\r\n    @Input()\r\n    get tick() { return this._tick; }\r\n    set tick(value: any) {\r\n        this._tick = coerceNumberProperty(value);\r\n    }\r\n    private _tick = 500;\r\n\r\n    @HostBinding('class.d-none')\r\n    _hiden = true;\r\n\r\n    count = 0;\r\n\r\n    constructor(private el: ElementRef, private renderer: Renderer2, private cd: ChangeDetectorRef, @Inject(DOCUMENT) private doc: any) {}\r\n\r\n    private update() {\r\n        const count = this.formEl.querySelectorAll(ANTDERRORCLS).length;\r\n        if (count === this.count) return;\r\n        this.count = count;\r\n        this._hiden = count === 0;\r\n        this.cd.markForCheck();\r\n    }\r\n\r\n    @HostListener('click')\r\n    _click() {\r\n        if (this.count === 0) return false;\r\n        // nz-form-item\r\n        let formItemEl = this.findParent(this.formEl.querySelector(ANTDERRORCLS), '[nz-form-item]');\r\n        if (!formItemEl) formItemEl = this.formEl.querySelector(ANTDERRORCLS);\r\n        formItemEl.scrollIntoView(true);\r\n        // fix header height\r\n        this.doc.documentElement.scrollTop -= HEADERMINHEIGHT;\r\n    }\r\n\r\n    private install() {\r\n        this.uninstall();\r\n        if (this.tick < 300) this.tick = 300;\r\n        this.$time = setInterval(() => this.update(), this.tick);\r\n    }\r\n\r\n    private uninstall() {\r\n        if (this.$time) clearInterval(this.$time);\r\n    }\r\n\r\n    private findParent(el: any, selector: string) {\r\n        let retEl = null;\r\n        while (el) {\r\n            if (el.querySelector(selector)) {\r\n                retEl = el;\r\n                break;\r\n            }\r\n            el = el.parentElement;\r\n        }\r\n        return retEl;\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.formEl = this.findParent(this.el.nativeElement, 'form');\r\n        if (this.formEl === null) throw new Error('未找到有效 form 元素');\r\n        (this.el.nativeElement as HTMLElement).classList.add('error-collect', 'pr-lg', 'text-error', 'point');\r\n        this.install();\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.uninstall();\r\n    }\r\n}\r\n"]}