{"version":3,"file":"image.directive.js","sourceRoot":"","sources":["../../../.ng_build/abc/image/image.directive.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAa,UAAU,EAAE,SAAS,EAAuC,MAAM,eAAe,CAAC;AACxH,OAAO,EAAE,WAAW,EAAE,MAAM,gBAAgB,CAAC;;;;;;;;IAmBzC,wBAAoB,EAAc,EAAU,MAAiB,EAAE,GAAgB;QAA3D,OAAE,GAAF,EAAE,CAAY;QAAU,WAAM,GAAN,MAAM,CAAW;oBAN7C,EAAE;qBAED,uBAAuB;sBAEvB,KAAK;QAGlB,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;KAC5B;IAED,iCAAQ,GAAR;QACI,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;KACtB;IAED,oCAAW,GAAX,UAAY,OAA6D;QACrE,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YACd,EAAE,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC;gBACd,IAAI,CAAC,WAAW,EAAE,CAAC;YACvB,IAAI;gBACA,IAAI,CAAC,MAAM,EAAE,CAAC;SACrB;KACJ;IAEO,+BAAM,GAAd;QACI,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC;;QAGtB,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC9B,IAAM,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,EACvB,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACjC,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;YAC1F,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC1B;;;QAID,IAAM,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,EACnC,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAC5C,EAAE,CAAC,CAAC,MAAM,IAAI,OAAO,CAAC;YAClB,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;QAI3C,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;KAClE;IAEO,oCAAW,GAAnB;QACI,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,SAAS,EAAE,eAAa,IAAI,CAAC,KAAK,OAAI,CAAC,CAAC;KAC3F;;gBAvDJ,SAAS,SAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE;;;;gBATK,UAAU;gBAAE,SAAS;gBAClD,WAAW;;;wBAWf,KAAK,SAAC,MAAM;yBAEZ,KAAK;0BAEL,KAAK;;yBAhBV;;SAUa,cAAc","sourcesContent":["import { Directive, Input, OnChanges, ElementRef, Renderer2, SimpleChanges, OnInit, SimpleChange } from '@angular/core';\r\nimport { ImageConfig } from './image.config';\r\n\r\n/**\r\n * img标签\r\n * + 支持微信、qq头像规则缩略图规则\r\n * + 支持移除http&https协议http\r\n * + 支持增加onerror事件\r\n */\r\n@Directive({ selector: '[_src]' })\r\nexport class ImageDirective implements OnChanges, OnInit {\r\n\r\n    @Input('_src') src: string;\r\n\r\n    @Input() size = 64;\r\n\r\n    @Input() error = './assets/img/logo.svg';\r\n\r\n    private inited = false;\r\n\r\n    constructor(private el: ElementRef, private render: Renderer2, DEF: ImageConfig) {\r\n        Object.assign(this, DEF);\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.update();\r\n        this.updateError();\r\n        this.inited = true;\r\n    }\r\n\r\n    ngOnChanges(changes: { [P in keyof this]?: SimpleChange } & SimpleChanges): void {\r\n        if (this.inited) {\r\n            if (changes.error)\r\n                this.updateError();\r\n            else\r\n                this.update();\r\n        }\r\n    }\r\n\r\n    private update() {\r\n        let newSrc = this.src;\r\n\r\n        // region: fix weixin & qq avatar size\r\n        if (newSrc.includes('qlogo.cn')) {\r\n            const arr = newSrc.split('/'),\r\n                  size = arr[arr.length - 1];\r\n            arr[arr.length - 1] = (size === '0' || +size !== this.size) ? this.size.toString() : size;\r\n            newSrc = arr.join('/');\r\n        }\r\n        // endregion\r\n\r\n        // region: remove https & http\r\n        const isHttp = newSrc.startsWith('http:'),\r\n              isHttps = newSrc.startsWith('https:');\r\n        if (isHttp || isHttps)\r\n            newSrc = newSrc.substr(isHttp ? 5 : 6);\r\n\r\n        // endregion\r\n\r\n        this.render.setAttribute(this.el.nativeElement, 'src', newSrc);\r\n    }\r\n\r\n    private updateError() {\r\n        this.render.setAttribute(this.el.nativeElement, 'onerror', `this.src='${this.error}';`);\r\n    }\r\n}\r\n"]}